<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/css/main.css">
    <title>Vigorize</title>
</head>
<body class="bg-[#f4d7b2] h-screen flex items-center justify-center">
    <div class="w-full max-w-md">

        <div class="text-center">
            <img src="{{ url_for('static', filename='VIGORIZE.svg') }}" alt="Logo VIGORIZE" class="mx-auto mb-4 w-24">
            <h1 class="text-2xl text-green-700 font-bold">VIGORIZE</h1>
        </div>
 
        <style>
            input::placeholder {
                font-size: 12px; 
                color: #576A5C; 
                padding: 8px;
            }

            input {
                border-radius: 10px;
            }
        </style>

        <div class="search-container">
            <form method="post">
                <input type="text" id="search-bar" placeholder="Pesquisar..." onkeyup="filterItems()">
                <select id="item-select" name="item" size="5">
                    {% for item in items %}
                        <option value="{{ item.Nome }}">{{ item.Nome }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="add-button">Adicionar</button>
            </form>
        </div>

        <div class="button-container">
            {% for button in buttons %}
                <div class="button-wrapper" data-id="{{ loop.index }}">
                    <button class="inflated-button">{{ button }}</button>
                    <span class="delete-icon" onclick="excluirBotao('{{ loop.index }}')">x</span>
                </div>
            {% endfor %}
        </div>

        <script>
            function filterItems() {
                let input = document.getElementById('search-bar').value.toLowerCase();
                let options = document.getElementById('item-select').options;
                for (let i = 0; i < options.length; i++) {
                    let option = options[i];
                    if (option.value.toLowerCase().includes(input)) {
                        option.style.display = '';
                    } else {
                        option.style.display = 'none';
                    }
                }
            }
                
            function excluirBotao(id) {
            var buttonWrapper = document.querySelector(`.button-wrapper[data-id='${id}']`);
            
            // Remover visualmente o botão antes de enviar a requisição
            if (buttonWrapper) {
                buttonWrapper.remove();
            }

            // Enviar a requisição para o backend para remover o botão da sessão
            fetch('/remover-botao', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({ id: id })  // Envia o id do botão para o backend
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Botão removido com sucesso');
                } else {
                    console.error('Erro ao remover botão:', data.error);
                }
            })
            .catch((error) => console.error('Erro:', error));
            }

        </script>

    </div>
</body>
</html>
